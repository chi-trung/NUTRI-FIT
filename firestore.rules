rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Quy tắc cho collection gốc (không đổi)
    match /exercises/{exerciseId} {
      allow read: if true;
      allow write: if false;}
    match /meals/{mealId} {
      allow read: if true;
      allow write: if false;
    }

    // Quy tắc cho collection người dùng
    match /users/{userId} {
      // Cho phép user đọc và cập nhật thông tin của chính họ
      allow read, update: if request.auth != null && request.auth.uid == userId;
      // Cho phép user tự tạo tài khoản
      allow create: if request.auth != null;

      // *** QUY TẮC MỚI CHO SUB-COLLECTION ***
      // Cho phép user tự đọc/ghi/xóa nhật ký TẬP LUYỆN của chính họ
      match /completed_workouts/{workoutId} {
        allow read, write, delete: if request.auth != null && request.auth.uid == userId;
      }

      // Cho phép user tự đọc/ghi/xóa nhật ký ĂN UỐNG của chính họ
      // (Bạn nên gộp cả quy tắc daily_intakes vào đây cho gọn)
      match /daily_intakes/{intakeId} {
         allow read, write, delete: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
}
